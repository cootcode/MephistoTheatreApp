@model DGrabowski_MephistoTheatreApp.Models.Post

@{
    ViewBag.Title = Model.Title;
}

<style>
    /* Custom styles for search widget */
    .search-card {
        width: 100%;
    }
</style>

<!-- Horizontal Image with three masks top of the page-->
<img src="~/images/triplemasksimage.png" class="img-fluid" alt="Responsive Image" />
<!-- Page content-->
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8">
            <!-- Post content-->
            <article>
                <!-- Post header-->
                <header class="mb-4">
                    <!-- Post title-->
                    <h1 class="fw-bolder mb-1">@Model.Title</h1>
                    <!-- Post meta content-->
                    <div class="text-muted fst-italic mb-2">Posted on @Model.CreatedAt.ToShortDateString() by @Model.Staff.FirstName @Model.Staff.LastName (@Model.Staff.UserName)</div>
                    <!-- Post categories-->
                    <div>
                        <a class="badge bg-secondary text-decoration-none link-light" href="#!">@Model.Category.CategoryName</a>
                    </div>
                </header>
                <!-- Preview image figure-->
                <figure class="mb-4">
                    <img class="img-fluid rounded" src="@Url.Content(Model.Category.ImagePath)" alt="..." />
                </figure>
                <!-- Post content-->
                <section class="mb-5">
                    @Html.Raw(Model.Body) <!-- Render HTML content -->
                </section>
            </article>
            <!-- Comments section -->
            <section class="mb-5">
                <div class="card bg-light">
                    <div class="card-body">
                        <!-- Comment form -->
                        <form id="comment-form" class="mb-4">
                            <textarea class="form-control" rows="3" placeholder="Join the discussion and leave a comment!" id="comment-text" style="max-width:100%"></textarea>
                            <button type="button" class="btn btn-primary mt-2" onclick="submitComment()">Submit Comment</button>
                        </form>
                        <!-- Comment container -->
                        <div id="comments-container" class="col-lg-12">
                            @Html.Partial("_Comments", Model.Comments.ToList())
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <div class="col-lg-4">
            <!-- Side widgets-->
            <div class="col-lg-12">
                <!-- Search widget-->
                <div class="card mb-4 search-card">
                    <div class="card-header">Search</div>
                    <div class="card-body">
                        @using (Html.BeginForm("Search", "Post", FormMethod.Get, new { @class = "input-group", onsubmit = "return validateSearchForm();" }))
                        {
                            <input class="form-control" type="text" name="SearchTerm" placeholder="Enter search term..." aria-label="Enter search term..." aria-describedby="button-search" required />
                            <button class="btn btn-primary" id="button-search" type="submit">Go!</button>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function submitComment() {
        // Get the comment text from the textarea
        var commentText = document.getElementById("comment-text").value;

        // Perform any validation if needed

        // Make an AJAX request to submit the comment to the server
        // Adjust the URL and other parameters based on your server-side implementation
        // For simplicity, this example assumes you are using jQuery for the AJAX request
        $.ajax({
            url: '/YourController/SubmitComment',
            method: 'POST',
            data: { comment: commentText },
            success: function (data) {
                // Handle the success response, e.g., update the comments container
                $('#comments-container').html(data);
                // Clear the comment textarea
                document.getElementById("comment-text").value = "";
            },
            error: function (error) {
                // Handle the error response
                console.error('Error submitting comment:', error);
            }
        });
    }
</script>